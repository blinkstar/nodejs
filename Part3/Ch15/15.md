# 第15章 用 TLS\/SSL 保证服务器的安全性

## 本章提要：

* 理解公钥基础结构是如何工作的
* 创建 TLS 服务器
* 连接 TLS 服务器
* 验证服务器和客户端证书
* 安全地收发数据

传输层安全 \(Transport Layer Security, TLS\) 和安全套接字层 \(Secure Socket Layer, SSL\) 允许客户端\/服务器应用程序以阻止
窃听 \(其他人看到你的消息\) 和篡改 \(别人修改你的消息\) 的方式通过网络进行通信。TLS\/SSL 会在 **传输层 **上对网络连接进行加密，这使得隐私和消息都能得到验证。

TLS 是基于  NetScape 公司开发的早期 SSL 规范，实际上，TLS 1.0 也被称为 SSL 3.1 ，而最新版的 TLS \(TLS 1.2\) 也被称为 SSL 3.3 。
本章将用 TLS 代替遭轻视的 SSL 命名法。

## 15.1 理解私钥和公钥

公钥加密是指需要两个独立密钥的加密系统，一个密钥用来加密明文，另一个密钥解密已加密的消息。其中一个密钥是公有的，另一个是私有的，如果
明文使用公钥加密，那么只能用私钥对其进行解密，这可以使公钥拥有者和私钥拥有者进行私有通信。如果明文是用私钥加密的，那么公钥就可以对其
进行解密，在这种情况下，系统会验证私钥拥有者在文档上的签名。

公钥证书\(也被称作数字证书\)使用数字签名绑定公钥和身份信息 -- 个人或者是组织。文档会由认证中心进行签名，认证中心会完成验证匹配公钥的
身份信息的过程。认证中心会响应其他证书，无论这个证书是自签名的还是由其他认证中心签名的，这样就会形成一个授权链，这个授权链是公钥
基础结构的一部分。

每台计算机都会定义一组根认证中心，在默认情况下用它们来验证认证和认证链。在使用 Node 的 TLS 库时，可以使用这些默认的认证中心或者
自定义的认证中心。

### 15.1.1 产生私钥

注意：Node 中的 TLS 是基于 OpenSSL 库实现的，可能你已经安装了这个库，为了检查安装与否，需要打开一个终端并尝试使用 openssl 命令，如果
OpenSSL 库没有安装，就要查找 openssl 包并安装。

TLS 依赖于公钥\/私钥基础结构，在这个基础结构中，每个客户端和服务器都必须有一个私钥对消息签名。openssl 实用程序可以在命令行上创建私钥，
如下所示：

```
$ openssl genrsa -out my_key.pem 1024
```

上述命令创建了一个文件 my\_key.pem ，也即私钥。

### 15.1.2 产生公钥

涉及 TLS 的服务器和客户端在彼此验证时必须具有一个证书，证书是由认证中心签名或者自签名的公钥。获取证书的第一步是创建一个证书签发请求
\(Certificate Signing Request, CSR\) 文件，如下所示：

```
$ openssl req -new -key my_key.pem -out my_csr.pem
```

上述命令会创建一个 CSR 文件 my\_csr.pem ,但首先你必须回答几个由 openssl 提出的身份认证问题。

为了用 CSR 创建自签名的证书，可以如下所示：

```
$ openssl x509 -req in my_csr.pem -signkey my_key.pem -out my_cert.pem
```

上述命令会在私钥和认证请求的基础上创建一个自签名文件 my\_cert.pem 。另一种方法是将 CSR 发送到认证中心进行签名，但是对于研究本章中的
示例而言，自签名认证已经足够了。

